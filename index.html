<!DOCTYPE html>
<html lang="lt">
<head>
<meta charset="utf-8">
<title>üèÜ Balsavimo rezultatai</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#141e30,#243b55);
  color:white;
  text-align:center;
  margin:0;
  padding:20px;
}

/* VIDEO FONAS */
#videoBackground {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  overflow: hidden;
}

#videoBackground iframe {
  width: 100vw;
  height: 100vh;
  pointer-events: none;
}

body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.6);
  z-index: 0;
}

table{
  width:95%;
  max-width:1000px;
  margin:auto;
  border-collapse:collapse;
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(10px);
  border-radius:10px;
  overflow:hidden;
}

th,td{
  padding:12px;
  border-bottom:1px solid rgba(255,255,255,0.1);
}

tr:hover{background:rgba(255,255,255,0.1); cursor:pointer;}

img{
  width:45px;
  height:45px;
  border-radius:50%;
  vertical-align:middle;
  margin-right:10px;
  object-fit:cover;
}

canvas{
  max-width:900px;
  margin:40px auto;
}

#soundBtn{
  position:fixed;
  bottom:20px;
  right:20px;
  padding:12px 20px;
  border:none;
  border-radius:25px;
  background:#E8C97A;
  font-weight:bold;
  cursor:pointer;
  z-index:1001;
}

#toast{
  position:fixed;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  background:#E8C97A;
  color:black;
  padding:10px 20px;
  border-radius:20px;
  display:none;
  font-weight:bold;
  z-index:1000;
}
</style>
</head>

<body>

<div id="videoBackground">
  <iframe 
    id="bgVideo"
    src="https://www.youtube.com/embed/N1y7G6UQi_0?enablejsapi=1&controls=0&loop=1&playlist=N1y7G6UQi_0"
    frameborder="0"
    allow="autoplay; fullscreen"
    allowfullscreen>
  </iframe>
</div>

<h2>üèÜ Balsavimo rezultatai</h2>
<button id="soundBtn">üîä ƒÆjungti garsƒÖ</button>

<table id="tbl"></table>
<canvas id="pieChart"></canvas>
<div id="toast"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
const VIDEOS = {
  holdMyOwn: "N1y7G6UQi_0",
  parade: "hgcP25DYLSw"
};

let player;
let pieChart;

function onYouTubeIframeAPIReady() {
  player = new YT.Player('bgVideo');
}

function changeBackgroundVideo(videoId){
  if(player){
    player.loadVideoById(videoId);
    player.setVolume(100);
    player.playVideo();
  }
}

function handleRowClick(name){
  if(name.includes("Hold My Own")){
    changeBackgroundVideo(VIDEOS.holdMyOwn);
    showToast("üéµ Groja: Hold My Own");
  }

  if(name.includes("Parade")){
    changeBackgroundVideo(VIDEOS.parade);
    showToast("üéµ Groja: Parade");
  }
}

function showToast(text){
  const toast=document.getElementById("toast");
  toast.innerText=text;
  toast.style.display="block";
  setTimeout(()=>toast.style.display="none",3000);
}

function fetchData(){
  fetch("https://www.lrt.lt/api/v1/daily-question/2417?t="+Date.now(),{cache:"no-store"})
  .then(res=>res.json())
  .then(data=>{

    const table=document.getElementById("tbl");
    table.innerHTML=`
      <tr>
        <th>Dalyvis</th>
        <th>Balsai</th>
        <th>%</th>
      </tr>`;

    let sorted=data.choices.sort((a,b)=>b.votes-a.votes);

    sorted.forEach((c,index)=>{
      let cleanName=c.name.replace(/\/+/g,'');

      table.innerHTML+=`
        <tr onclick="handleRowClick('${cleanName}')">
          <td>
            <img src="${c.image}">
            <strong>${index+1}. ${cleanName}</strong>
          </td>
          <td>${c.votes.toLocaleString()}</td>
          <td>${c.percentage}%</td>
        </tr>`;
    });

    updatePieChart(sorted);
  });
}

function updatePieChart(data){
  const ctx=document.getElementById('pieChart').getContext('2d');
  let labels=data.map(c=>c.name.replace(/\/+/g,''));
  let votes=data.map(c=>c.votes);

  if(pieChart) pieChart.destroy();

  pieChart=new Chart(ctx,{
    type:'pie',
    data:{
      labels:labels,
      datasets:[{
        data:votes,
        backgroundColor:[
          '#F6DFA6','#D9D9D9','#D7B49E','#A5D6A7','#B2DFDB'
        ]
      }]
    },
    options:{
      responsive:true,
      plugins:{legend:{position:'bottom'}}
    }
  });
}

document.getElementById("soundBtn").addEventListener("click", function(){
  if(player){
    player.unMute();
    player.setVolume(100);
    player.playVideo();
    this.innerText = "üîà Garsas ƒØjungtas";
  }
});

fetchData();
setInterval(fetchData,5000);
</script>

</body>
</html>
